{"version":3,"file":"js/256.b2f59202.js","mappings":"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","sources":["webpack://vue/./src/views/front/Chat.vue","webpack://vue/src/views/front/Chat.vue","webpack://vue/./src/views/front/Chat.vue?c928","webpack://vue/./src/views/front/Chat.vue?76f5"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticStyle:{\"width\":\"60%\",\"margin\":\"10px auto\"}},[_c('div',{staticStyle:{\"display\":\"flex\",\"grid-gap\":\"20px\"}},[_c('div',{staticClass:\"chat-card\",staticStyle:{\"width\":\"200px\",\"min-height\":\"600px\"}},[_vm._l((_vm.chatGroupList),function(item){return (_vm.chatGroupList.length > 0)?_c('div',{key:item.id,on:{\"click\":function($event){return _vm.loadChatList(item.chatUserId)}}},[(item.userId === _vm.user.id)?_c('div',{staticClass:\"chat-group\",class:{'chat-group-active' : item.chatUserId === _vm.activeChatUserId},staticStyle:{\"position\":\"relative\"}},[_c('img',{staticStyle:{\"width\":\"50px\",\"height\":\"50px\",\"border-radius\":\"50%\"},attrs:{\"src\":item.chatUserAvatar}}),(item.chatNum > 0 && !_vm.activeChatUserId)?_c('el-badge',{attrs:{\"value\":item.chatNum,\"max\":99}},[_c('span',{staticStyle:{\"color\":\"#333\"}},[_vm._v(_vm._s(item.chatUserName))])]):_c('span',{staticStyle:{\"color\":\"#333\"}},[_vm._v(_vm._s(item.chatUserName))]),_c('i',{staticClass:\"el-icon-close\",staticStyle:{\"position\":\"absolute\",\"top\":\"10px\",\"right\":\"10px\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.closeGroup(item.id)}}})],1):_vm._e()]):_vm._e()}),(_vm.chatGroupList.length === 0)?_c('div',{staticStyle:{\"color\":\"#666\",\"padding\":\"20px 0\",\"text-align\":\"center\"}},[_vm._v(\"暂无聊天对象..\")]):_vm._e()],2),_c('div',{staticClass:\"chat-card\",staticStyle:{\"flex\":\"1\",\"height\":\"600px\"}},[_c('div',{ref:\"chatContainer\",staticClass:\"chat-text\",staticStyle:{\"height\":\"450px\",\"border-bottom\":\"1px solid #ddd\",\"overflow-y\":\"auto\"}},_vm._l((_vm.chatList),function(item){return _c('div',{key:item.id,staticStyle:{\"margin-bottom\":\"20px\"}},[(item.chatUserId === _vm.user.id)?_c('div',[_c('div',{staticStyle:{\"color\":\"#666\",\"font-size\":\"12px\",\"padding\":\"5px 0\",\"margin\":\"5px 0\",\"text-align\":\"center\"}},[_vm._v(_vm._s(item.time))]),_c('div',{staticStyle:{\"display\":\"flex\",\"grid-gap\":\"10px\"}},[_c('img',{staticStyle:{\"width\":\"50px\",\"height\":\"50px\",\"border-radius\":\"5px\"},attrs:{\"src\":item.userAvatar,\"alt\":\"\"}}),_c('div',{staticStyle:{\"max-width\":\"50%\",\"width\":\"fit-content\"}},[_c('div',{staticStyle:{\"color\":\"#666\",\"margin-bottom\":\"5px\"}},[_c('span',[_vm._v(_vm._s(item.userName))])]),_c('div',{staticStyle:{\"background-color\":\"#d1e7ff\",\"padding\":\"10px\",\"border-radius\":\"5px\"},domProps:{\"textContent\":_vm._s(item.text)}})])])]):_vm._e(),(item.userId === _vm.user.id)?_c('div',[_c('div',{staticStyle:{\"color\":\"#666\",\"font-size\":\"12px\",\"padding\":\"5px 0\",\"margin\":\"5px 0\",\"text-align\":\"center\"}},[_vm._v(_vm._s(item.time))]),_c('div',{staticStyle:{\"display\":\"flex\",\"justify-content\":\"right\",\"grid-gap\":\"10px\"}},[_c('div',{staticStyle:{\"max-width\":\"50%\",\"width\":\"fit-content\"}},[_c('div',{staticStyle:{\"color\":\"#666\",\"margin-bottom\":\"5px\",\"text-align\":\"right\"}},[_vm._v(_vm._s(item.userName))]),_c('div',{staticStyle:{\"background-color\":\"#a3eecb\",\"padding\":\"10px\",\"border-radius\":\"5px\"},domProps:{\"textContent\":_vm._s(item.text)}})]),_c('img',{staticStyle:{\"width\":\"50px\",\"height\":\"50px\",\"border-radius\":\"5px\"},attrs:{\"src\":item.userAvatar,\"alt\":\"\"}})])]):_vm._e()])}),0),_c('div',{staticStyle:{\"height\":\"150px\"}},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.form.text),expression:\"form.text\"}],staticStyle:{\"height\":\"100px\",\"width\":\"100%\",\"padding\":\"20px\",\"border\":\"none\",\"border-bottom\":\"1px solid #ddd\",\"outline\":\"none\"},domProps:{\"value\":(_vm.form.text)},on:{\"input\":function($event){if($event.target.composing)return;_vm.$set(_vm.form, \"text\", $event.target.value)}}}),_c('div',{staticStyle:{\"text-align\":\"right\",\"padding-right\":\"10px\"}},[_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":_vm.send}},[_vm._v(\"发送\")])],1)])])])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div style=\"width: 60%; margin: 10px auto\">\r\n\r\n    <div style=\"display: flex; grid-gap: 20px\">\r\n\r\n      <!-- 聊天组开始 -->\r\n      <div class=\"chat-card\" style=\"width: 200px; min-height: 600px\">\r\n        <div v-if=\"chatGroupList.length > 0\" @click=\"loadChatList(item.chatUserId)\" v-for=\"item in chatGroupList\" :key=\"item.id\">\r\n          <div style=\"position: relative\" v-if=\"item.userId === user.id\" class=\"chat-group\" :class=\"{'chat-group-active' : item.chatUserId === activeChatUserId}\">\r\n            <img :src=\"item.chatUserAvatar\" style=\"width: 50px; height: 50px; border-radius: 50%\" />\r\n            <el-badge :value=\"item.chatNum\" :max=\"99\" v-if=\"item.chatNum > 0 && !activeChatUserId\">\r\n              <span style=\"color: #333\">{{ item.chatUserName }}</span>\r\n            </el-badge>\r\n            <span v-else style=\"color: #333\">{{ item.chatUserName }}</span>\r\n\r\n            <i class=\"el-icon-close\" style=\"position: absolute; top: 10px; right: 10px\" @click.stop=\"closeGroup(item.id)\"></i>\r\n          </div>\r\n        </div>\r\n        <div v-if=\"chatGroupList.length === 0\" style=\"color: #666; padding: 20px 0; text-align: center\">暂无聊天对象..</div>\r\n      </div>\r\n      <!-- 聊天组结束 -->\r\n\r\n      <!-- 聊天消息开始 -->\r\n      <div class=\"chat-card\" style=\"flex: 1; height: 600px\">\r\n        <div class=\"chat-text\" ref=\"chatContainer\" style=\"height: 450px; border-bottom: 1px solid #ddd; overflow-y: auto;\">\r\n          <div v-for=\"item in chatList\" :key=\"item.id\" style=\"margin-bottom: 20px\">\r\n\r\n            <!-- 左边的聊天消息开始 -->\r\n            <!-- item.chatUserId === user.id 表示对方在跟当前登录的人聊天 user表示对方  显示对方的名称和头像        -->\r\n            <div v-if=\"item.chatUserId === user.id\">\r\n                <div style=\"color: #666; font-size: 12px; padding: 5px 0; margin: 5px 0; text-align: center;\">{{ item.time }}</div>\r\n                <div style=\"display: flex; grid-gap: 10px\">\r\n                    <img style=\"width: 50px; height: 50px; border-radius: 5px\" :src=\"item.userAvatar\" alt=\"\">\r\n                    <div style=\"max-width: 50%; width: fit-content\">\r\n                    <div style=\"color: #666; margin-bottom: 5px\">\r\n                        <span>{{ item.userName }}</span>\r\n                    </div>\r\n                    <div style=\"background-color: #d1e7ff; padding: 10px; border-radius: 5px;\" v-text=\"item.text\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- 左边的聊天消息结束 -->\r\n\r\n            <!-- 右边的聊天消息开始 -->\r\n            <div v-if=\"item.userId === user.id\">\r\n                <div style=\"color: #666; font-size: 12px; padding: 5px 0; margin: 5px 0; text-align: center;\">{{ item.time }}</div>\r\n                <div style=\"display: flex; justify-content: right; grid-gap: 10px\">\r\n                  <div style=\"max-width: 50%; width: fit-content\">\r\n                    <div style=\"color: #666; margin-bottom: 5px; text-align: right\">{{ item.userName }}</div>\r\n                    <div style=\"background-color: #a3eecb; padding: 10px; border-radius: 5px;\" v-text=\"item.text\"></div>\r\n                  </div>\r\n                  <img style=\"width: 50px; height: 50px; border-radius: 5px\" :src=\"item.userAvatar\" alt=\"\">\r\n                </div>\r\n            </div>\r\n            <!-- 右边的聊天消息结束 -->\r\n            \r\n          </div>\r\n        </div>\r\n        <!-- 聊天消息结束 -->\r\n\r\n        <!-- 聊天输入框开始 -->\r\n        <div style=\"height: 150px\">\r\n          <textarea v-model=\"form.text\" style=\"height: 100px; width: 100%; padding: 20px; border: none;\r\n             border-bottom: 1px solid #ddd; outline: none\"></textarea>\r\n          <div style=\"text-align: right; padding-right: 10px\">\r\n            <el-button type=\"primary\" size=\"mini\" @click=\"send\">发送</el-button>\r\n          </div>\r\n        </div>\r\n        <!-- 聊天输入框结束 -->\r\n\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nlet socket\r\n\r\nexport default {\r\n  name: \"Chat\",\r\n  data() {\r\n    return {\r\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\r\n      chatGroupList: [],\r\n      activeChatUserId: 0,\r\n      form: {},\r\n      chatList: [],\r\n      audio: null,\r\n      scrollToBottom: false, \r\n    }\r\n  },\r\n  created() {\r\n    this.init()\r\n    this.loadChatGroup()\r\n    this.loadAudio() // 加载音频\r\n  },\r\n  methods: {\r\n    loadAudio(){\r\n        const audioUrl = require('@/assets/audio/chat.mp3');  \r\n        this.audio = new Audio(audioUrl);  //替换为你的音频文件路径\r\n        this.audio.volume = 1 // 设置音量（0.0到1.0之间）\r\n    },\r\n    closeGroup(id) {\r\n      this.$request.delete('/chatGroup/delete/' + id).then(res => {\r\n        this.loadChatGroup()\r\n        this.chatList = []  // 清空聊天消息\r\n      })\r\n    },\r\n    send() {\r\n      if (!this.activeChatUserId) {\r\n        this.$message.warning('请选择聊天对象')\r\n        return\r\n      }\r\n      if (!this.form.text) {\r\n        this.$message.warning('请输入消息内容')\r\n        return\r\n      }\r\n      this.form.chatUserId = this.activeChatUserId\r\n      this.form.userId = this.user.id\r\n      this.$request.post('/chatInfo/add', this.form).then(res => {\r\n        this.form = {}\r\n        this.loadChatList(this.activeChatUserId)\r\n\r\n        // 发送socket消息\r\n        socket.send(this.user.id) //传递自己id以便接收消息语音提醒\r\n      })\r\n    },\r\n    loadChatList(chatUserId) {\r\n      this.scrollToBottom = true\r\n      this.form = {}\r\n      this.activeChatUserId = chatUserId\r\n\r\n      // 更新消息读取状态\r\n      this.$request.put('/chatInfo/updateRead/' + chatUserId).then(res => {\r\n        this.loadChatGroup()\r\n      })\r\n      this.$request.get('/chatInfo/selectUserChat/' + chatUserId).then(res => {\r\n        if(res.code == '200'){\r\n            this.chatList = res.data || []\r\n            // 使用 Vue 的 $nextTick 确保 DOM 更新完成后再滚动  \r\n            this.$nextTick(() => {\r\n              // 使用 Vue 的 ref 访问元素 \r\n              const chatContainer = this.$refs.chatContainer;\r\n              if (chatContainer) {  \r\n                if(this.scrollToBottom){ \r\n                  // 直接设置滚动容器的 scrollTop 为其 scrollHeight 来滚动到底部  \r\n                  chatContainer.scrollTop = chatContainer.scrollHeight;  \r\n                  this.scrollToBottom = false \r\n                }\r\n              } \r\n            })\r\n        }else{\r\n            this.$message.error(res.msg)\r\n        }\r\n      })\r\n    },\r\n    loadChatGroup() {\r\n      this.$request.get('/chatGroup/selectUserGroup').then(res => {\r\n        this.chatGroupList = res.data || []\r\n      })\r\n    },\r\n    init() {\r\n      let _this = this\r\n      if (typeof (WebSocket) == \"undefined\") {\r\n        console.log(\"您的浏览器不支持WebSocket\")\r\n      } else {\r\n        console.log(\"您的浏览器支持WebSocket\")\r\n        let socketUrl = \"ws://8.130.100.221:9020/chatServer/\" + this.user.id\r\n        if (socket != null) {\r\n          socket.close()\r\n          socket = null\r\n        }\r\n        // 开启一个websocket服务\r\n        socket = new WebSocket(socketUrl)\r\n        //打开事件\r\n        socket.onopen = function () {\r\n          console.log(\"websocket已打开\")\r\n        }\r\n        //  浏览器端收消息，获得从服务端数据库里的最新的聊天消息\r\n        socket.onmessage = function (msg) {\r\n          let userId = JSON.parse(msg.data)\r\n          if (userId == _this.user.id) {\r\n            _this.loadChatGroup()\r\n            _this.loadChatList(_this.activeChatUserId)\r\n          }else{\r\n            _this.loadChatGroup()\r\n            _this.loadChatList(_this.activeChatUserId)\r\n\r\n            // 播放音频\r\n            _this.audio.currentTime = 0 // 重置播放位置\r\n            _this.audio.play()\r\n          }\r\n        }\r\n        //关闭事件\r\n        socket.onclose = function () {\r\n          console.log(\"websocket已关闭\")\r\n        }\r\n        //发生了错误事件\r\n        socket.onerror = function () {\r\n          console.log(\"websocket发生了错误\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.chat-card {\r\n  background-color: #fff;\r\n  border-radius: 5px;\r\n  box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n.chat-group {\r\n  padding: 10px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  grid-gap: 10px;\r\n  border-bottom: 1px solid #ddd\r\n}\r\n.chat-group-active {\r\n  background-color: #d1e7ff;\r\n}\r\n.chat-text {\r\n  padding: 20px;\r\n}\r\n.chat-text::-webkit-scrollbar {\r\n  width: 10px;\r\n}\r\n.chat-text::-webkit-scrollbar-thumb {\r\n  border-radius: 8px;\r\n  background-color: #d1e7ff;\r\n}\r\n::v-deep .el-badge__content.is-fixed {\r\n  right: 0px;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./Chat.vue?vue&type=template&id=39c2b586&scoped=true\"\nimport script from \"./Chat.vue?vue&type=script&lang=js\"\nexport * from \"./Chat.vue?vue&type=script&lang=js\"\nimport style0 from \"./Chat.vue?vue&type=style&index=0&id=39c2b586&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"39c2b586\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticStyle","staticClass","_l","chatGroupList","item","length","key","id","on","$event","loadChatList","chatUserId","userId","user","class","activeChatUserId","attrs","chatUserAvatar","chatNum","_v","_s","chatUserName","stopPropagation","closeGroup","_e","ref","chatList","time","userAvatar","userName","domProps","text","directives","name","rawName","value","form","expression","target","composing","$set","send","staticRenderFns","socket","data","JSON","parse","localStorage","getItem","audio","scrollToBottom","created","init","loadChatGroup","loadAudio","methods","audioUrl","require","Audio","volume","$request","delete","then","res","post","$message","warning","put","get","code","$nextTick","chatContainer","$refs","scrollTop","scrollHeight","error","msg","_this","WebSocket","console","log","socketUrl","close","onopen","onmessage","currentTime","play","onclose","onerror","component"],"sourceRoot":""}